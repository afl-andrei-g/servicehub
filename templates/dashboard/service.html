{% extends "dashboard/base.html" %}
{% block title %}ServiceHub - AcasƒÉ{% endblock %}
{% block content %}
<main class="main-content">
    {% include "dashboard/header.html" %}

    <div class="dashboard-content">
        <section class="dashboard-section current-services">
            <div class="section-header">
                <h2>
                    <a href="{{appurl}}/dashboard"><i class="fa-solid fa-arrow-left"></i></a>    
                    Detalii despre servisare
                </h2>
            </div>
            <div class="service-card active">
                <div class="service-header">
                    <div class="service-id">#SRV-{{service.id}}</div>
                    <div class="service-date">{{service.date}}</div>
                </div>
                <div class="service-details">
                    <h3>{{service.title}}</h3>
                    <div class="service-provider">
                        <img src="{{company.avatar}}" alt="Provider">
                        <span>{{company.name}}</span>
                    </div>
                    <div class="vehicle-info">
                        <i class="fas fa-car"></i>
                        <span>{{vehicle.name}}</span>
                    </div>
                    <div class="service-progress">
                        <div class="progress-label">
                            <span>Progres</span>
                            <span>{{percentage}}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: {{percentage}}%;"></div>
                        </div>
                    </div>
                    <div class="service-timeline">
                        <div class="timeline-item 
                            {% if service.status > 1 %}completed
                            {% elif service.status == 1 %}active
                            {% endif %}">
                            <div class="timeline-icon">
                                <i class="fa-solid fa-location-dot"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Check-in vehicul</h4>
                                <p>
                                    {% if service.status > 1 %}Completat
                                    {% elif service.status == 1 %}Recep»õionat √Æn service-ul nostru üí™
                                    {% else %}√én a»ôteptare
                                    {% endif %}
                                </p>
                            </div>
                        </div>

                        <div class="timeline-item 
                            {% if service.status > 2 %}completed
                            {% elif service.status == 2 %}active
                            {% endif %}">
                            <div class="timeline-icon">
                                <i class="fa-solid fa-heart-pulse"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>DiagnozƒÉ</h4>
                                <p>
                                    {% if service.status > 2 %}Completat
                                    {% elif service.status == 2 %}EfectuƒÉm verificƒÉri complexe pentru a diagnostica problemele vehiculului üõ†Ô∏è
                                    {% else %}√én a»ôteptare
                                    {% endif %}
                                </p>
                            </div>
                        </div>

                        <div class="timeline-item 
                            {% if service.status > 3 %}completed
                            {% elif service.status == 3 %}active
                            {% endif %}">
                            <div class="timeline-icon">
                                <i class="fas fa-wrench"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Repara»õie</h4>
                                <p>
                                    {% if service.status > 3 %}Completat
                                    {% elif service.status == 3 %}√én repara»õie - ne asigurƒÉm cƒÉ vehiculul tƒÉu este reparat sau √Æntre»õinut corespunzƒÉtor ‚úÖ
                                    {% else %}√én a»ôteptare
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    
                        <div class="timeline-item 
                            {% if service.status == 4 %}active{% endif %}">
                            <div class="timeline-icon">
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Gata de preluare</h4>
                                <p>{% if service.status == 4 %}Te a»ôteptƒÉm sƒÉ-»õi ridici vehiculul din {{company.address}}.{% else %}√én a»ôteptare{% endif %}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="service-actions">
                    {% if user.account_type == 'technician' or user.account_type == 'company' %}
                    <form method="post">
                        {% csrf_token %}
                        <select class="btn-input" id="serviceStatus" name="serviceStatus" required>
                            <option value="">SelecteazƒÉ un status nou</option>
                            <option value="1">Check-in vehicul - Am preluat vehiculul √Æn service »ôi a»ôteptƒÉm diagnoza.</option>
                            <option value="2">Am √Ænceput diagnosticarea vehiculului pentru a gƒÉsi eventuale probleme.</option>
                            <option value="3">Am √Ænceput repara»õia pe baza diagnosticƒÉrii.</option>
                            <option value="4">Vehiculul a fost reparat »ôi este gata de preluare.</option>
                        </select>
                        <button class="btn-outline" type="submit" name="status">ActualizeazƒÉ status</button>
                    </form>
                    {% endif %}
                </div>
                <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid rgba(0,0,0, 0.2);">
                    <h2>DiscutƒÉ cu {% if user.account_type == 'technician' or user.account_type == 'company' %}clientul{% else %}tehnicianul{% endif %}</h2>
                    <div style="height: 200px; overflow-y: scroll; width: 100%; margin-top: 10px;" id="chat-box">
                        {% for i in notes %}
                        <div class="servicehub_flex">
                            <img src="{{i.avatar}}"/>
                            <div>
                                <p>{{i.user}} <small><font style="color: rgba(0, 0, 0, 0.3); margin-left: 5px;"><i class="fa-solid fa-clock"></i> {{i.friendly_timestamp}}</font></small></p>
                                <p>{{i.message}}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <form method="post" style="display: flex; margin-top: 15px; gap: 15px;">
                        {% csrf_token %}
                        <input class="btn-input" type="text" id="serviceMessage" name="serviceMessage" style="width: 70%;" placeholder="Scrie un mesaj..." {% if service.status == 4 %}disabled{% endif %} required/>
                        <button class="btn-outline" type="submit" name="servmsg" style="width: 15%;">Trimite mesajul</button>
                    </form>
                </div>
            </div>
        </section>
    </div>
</main>

<script>
    const chatBox = document.getElementById("chat-box");
    chatBox.scrollTop = chatBox.scrollHeight;

    TechModal = (action) => {
        $(`#AddTech`).css('display', action == 'open' ? 'block' : 'none');
    };
</script>
{% endblock %}